/*
 * Creates the topbar toggle menu and fixed header.
 *
 * TODO: Refactor and cleanup, this thing got messy!
 */(function(e){function t(t){var n=e(".js-topbar-user"),r=e(".js-topbar-search"),i=e(".js-topbar-menu"),s=e(".header-wrapper");switch(t){case"search":r.toggleClass("js-topbar-toggled");i.removeClass("js-topbar-toggled");n.removeClass("js-topbar-toggled");s.show();break;case"user":n.toggleClass("js-topbar-toggled");r.removeClass("js-topbar-toggled");i.removeClass("js-topbar-toggled");s.show();break;case"menu":i.toggleClass("js-topbar-toggled");r.removeClass("js-topbar-toggled");n.removeClass("js-topbar-toggled");s.hide()}}e(document).ready(function(){var n=e(".js-topbar-link"),r=e(".header-wrapper");n.on("click touchstart",function(i){var s=e(this);if(s.hasClass("topbar-link-user")){t("user");e(".js-topbar-user #edit-name").focus()}if(s.hasClass("topbar-link-search")){t("search");e(".js-topbar-search #edit-search-block-form--2").focus()}if(s.hasClass("topbar-link-menu")){t("menu");s.focus()}if(s.hasClass("active")){s.removeClass("active");r.hide();s.focus();n.one("touchend",function(){s.css("background-color","inherit")});e("body").removeClass("js-fixed-body")}else{s.css("background-color","");n.removeClass("active");s.addClass("active");e("body").addClass("js-fixed-body")}i.preventDefault()});n.removeClass("active");r.hide();var i=window.location.pathname;i.indexOf("/search",0)===0&&e("#search-block-form").clone().insertBefore(".pane-ting-search-sort-form");i==="/"&&e("a.topbar-link-search").click();var s=e(".site-header"),o=s.offset(),u=parseInt(e("body").css("paddingTop"),10);u&&(o.top=o.top-u);var a=o.top+5,f=!1;e(window).scroll(function(){var t=e(window).scrollTop();if(t>a&&!f){s.addClass("js-fixed");f=!0;if(e(".search").hasClass("js-topbar-toggled")){e(".header-wrapper").slideToggle("fast");e("a.topbar-link-search").removeClass("active")}}else if(t<a&&f){s.removeClass("js-fixed");f=!1;if(e(".search").hasClass("js-topbar-toggled")){e(".header-wrapper").show();e("a.topbar-link-search").addClass("active")}}});if(e(".pane-news-category-menu").length>0){e(".pane-news-category-menu .sub-menu").clone().appendTo(".menu-mlid-1793");e(".main-menu .sub-menu").addClass("main-menu");e(".main-menu .sub-menu").removeClass("sub-menu");e(".pane-news-category-menu").addClass("sub-menu-wrapper")}if(e(".pane-event-category-menu").length>0){e(".pane-event-category-menu .sub-menu").clone().appendTo(".menu-mlid-1816");e(".main-menu .sub-menu").addClass("main-menu");e(".main-menu .sub-menu").removeClass("sub-menu");e(".pane-event-category-menu").addClass("sub-menu-wrapper")}})})(jQuery);